<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Student To Do</title> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
</head>
<body>
    <main class="container">
        <h1>Student To Do App- Del 1</h1>

        <nav>
            <ul>
                <li>
                    <a role="button" href="{{url_for('home', filter='alle')}}" class="{{'secondary' if filter_val == 'alle' else '' }}">Alle
                    </a>
                </li>
                <li>
                    <a role="button" href="{{ url_for('home', filter='ferdig') }}" class="{{'secondary' if filter_val== 'ferdig' else '' }}">Ferdig 
                    </a>
                </li>
                <li>
                    <a role="button" href="{{ url_for('home', filter='uferdig')}}" class="{{ 'secondary' if filter_val == 'uferdig' else '' }}">Uferdig
                    </a>
                </li>
            </ul>
        </nav>

            
        {% if varslinger %}
        <div class="varsling-boks" id="varslingBox">
            <span class="varsling-ikon">游댒</span>
            <div class="varsling-innhold">
                <h3>Frist n칝rmer seg!</h3>
                <ul class="varsling-liste">
                    {% for v in varslinger %}
                    <li class="varsling-linje">
                        <span class="badge-days">{{ 'i dag' if v.days_left == 0 else v.days_left ~ ' d igjen' }}</span>
                        <span class="varsling-tekst">{{ v.tittel}} - {{ v.frist }}</span>
                        <span class="varsling-actions">
                            <a role="button" href="{{ url_for('status' , index=v.__global_index) }}">Bytt status</a>
                            <a role="button" href="{{ url_for('snooze', index=v.__global_index) }}">Utsett 1 dag</a>
                            <a role="button" class="secondary" href="{{ url_for('fjern', index=v.__global_index) }}">Fjern</a>
                        </span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <button class="varsling-close" aria-label="Lukk" title="Lukk" onclick="closeVarsel()">칑</button>

        </div>
        {% endif %}



        <h2>Legg til ny oppgave</h2>
        <h3>Sortert etter frist(n칝rmest dato, f칮rst)</h3>

        <form method="POST">
            <label for ="tittel">Tittel:</label>
            <input type="text" id="tittel" name="tittel" required>
            <label for="frist">Frist:</label>
            <input type="date" id="frist" name="frist" required>
            <button type="submit">Legg til</button>
        </form>
        <h2>Dine Oppgaver</h2> 
        <ul>
            {% for oppgave in oppgaver %}
            <li>
                <span class="{{ 'ferdig' if oppgave.ferdig else 'uferdig' }}">
                    {{ oppgave.tittel }} - {{ oppgave.frist }}
                </span>
                <a href="{{ url_for('status', index=oppgave.__global_index) }}">Bytt status</a>
                <a href="{{ url_for('fjern', index=oppgave.__global_index) }}">Fjern</a>
            </li>
            {% else %}
            <li>Ingen Oppgaver Enda</li>
            {% endfor %}
        </ul>

        <section class="calendar">
            <h2> Kalender- neste 7 dager</h2>
            <div class="grid">
                {% for dato,oppgaver_p친_dato in kalender %}
                    <article>
                        <div class="day-header">
                            <span class="day-date">{{ dato }}</span>
                            <span class="day-count">{{ oppgaver_p친_dato|length }}</span>
                        </div>
                        <div class="day-body">
                            {% if oppgaver_p친_dato %}
                            <ul class="mini-list">
                                {% for o in oppgaver_p친_dato %}
                                <li>
                                    <details class="calendar-item {{ 'ferdig' if o.ferdig else 'uferdig' }}">
                                        <summary>游닇{{o.tittel}}</summary>
                                        <div class="cal-detail">
                                            <p>Frist: {{ o.frist }}</p>
                                            <p>Status: {{ "Ferdig" if o.ferdig else "Uferdig" }}</p>
                                            <p>
                                                <a role="button" href="{{ url_for('status', index=o.__global_index) }}">Bytt status</a>

                                                <a role="button" class="secondary" href="{{ url_for('fjern', index=o.__global_index) }}">Fjern</a>
                                            </p>
                                        </div>
                                    </details>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                        <div class="no-tasks">Ingen oppgaver</div>
                        {% endif %}
                        </div>
                    </article>
                {% endfor %}
            </div>
        </section>
    </main>
    <script>
        (function(){
            const box = document.getElementById("varslingBox");
            if (!box) return;
            const KEY= "varslingDismissedSession";
            if (sessionStorage.getItem(KEY)=="1") { box.remove(); return; }
            window.closeVarsel= function() {
                try {sessionStorage.setItem(KEY, "1"); } catch (e) {}
                box.style.opacity = 0; setTimeout (()=> box.remove(), 300);
            };
        })();
    </script>
</body>
</html>